apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: backend-route
  namespace: foundry-idp
spec:
  parentRefs:
  - name: foundry-idp-gateway
    namespace: foundry-idp
    sectionName: http
  - name: foundry-idp-gateway
    namespace: foundry-idp
    sectionName: https
  hostnames:
  - api.foundry-idp.com
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /
    backendRefs:
    - name: backend-service
      port: 8000
    filters:
    - type: ResponseHeaderModifier
      responseHeaderModifier:
        add:
        - name: Access-Control-Allow-Origin
          value: "https://foundry-idp.com,https://www.foundry-idp.com"
        - name: Access-Control-Allow-Methods
          value: "GET, POST, PUT, DELETE, PATCH, OPTIONS"
        - name: Access-Control-Allow-Headers
          value: "Content-Type, Authorization, X-Requested-With, X-Business-Unit-Id, Accept, Origin"
        - name: Access-Control-Allow-Credentials
          value: "true"
        - name: Access-Control-Max-Age
          value: "3600"
        - name: X-Frame-Options
          value: SAMEORIGIN
        - name: X-Content-Type-Options
          value: nosniff
        - name: X-XSS-Protection
          value: "1; mode=block"
        - name: Referrer-Policy
          value: strict-origin-when-cross-origin

